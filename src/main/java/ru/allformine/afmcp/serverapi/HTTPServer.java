package ru.allformine.afmcp.serverapi;

import com.sun.net.httpserver.*;
import org.spongepowered.api.Sponge;
import org.spongepowered.api.entity.living.player.Player;
import org.spongepowered.api.scheduler.Task;
import ru.allformine.afmcp.AFMCorePlugin;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.InetSocketAddress;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class HTTPServer implements Runnable {
    String defaultBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAA4JGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMwNjcgNzkuMTU3NzQ3LCAyMDE1LzAzLzMwLTIzOjQwOjQyICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTktMDQtMTZUMjI6MTU6NTMrMDM6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxOS0wNC0xNlQyMjo0OToxMiswMzowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTktMDQtMTZUMjI6NDk6MTIrMDM6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6ODg4YzM2MTAtMWM4Ni04ODRiLWE5NTgtZmQ5ZTE0YjM0MWIyPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjg4OGMzNjEwLTFjODYtODg0Yi1hOTU4LWZkOWUxNGIzNDFiMjwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD54bXAuZGlkOjg4OGMzNjEwLTFjODYtODg0Yi1hOTU4LWZkOWUxNGIzNDFiMjwveG1wTU06T3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPmNyZWF0ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDo4ODhjMzYxMC0xYzg2LTg4NGItYTk1OC1mZDllMTRiMzQxYjI8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTktMDQtMTZUMjI6MTU6NTMrMDM6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NTA8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NTA8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg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";

    @Override
    public void run() {
        int port = AFMCorePlugin.getConfig().getNode("server_api", "port").getInt();
        HttpServer server;

        AFMCorePlugin.logger.info("[AFMCP_APISERVER] Starting HTTP server at port " + port);

        try {
            server = HttpServer.create();
            server.bind(new InetSocketAddress(port), 0);

            HttpContext context = server.createContext("/serverAPI", new EchoHandler());
            context.setAuthenticator(new Auth());

            server.setExecutor(null);
            server.start();

            AFMCorePlugin.logger.info("[AFMCP_APISERVER] HTTP server has been successfully started!");
        } catch (Exception e) {
            AFMCorePlugin.logger.info("[AFMCP_APISERVER] Error starting api server!");
            e.printStackTrace();
        }
    }

    class EchoHandler implements HttpHandler {
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            try {
                InputStreamReader isr = new InputStreamReader(exchange.getRequestBody());
                BufferedReader br = new BufferedReader(isr);
                String input = br.readLine();

                AFMCorePlugin.logger.info("[AFMCP_APISERVER] Input: " + input);
                List<String> args = new ArrayList<>(Arrays.asList(input.split(" ")));
                String cmd = args.remove(0);

                switch (cmd) {
                    case "EX_COMMAND":
                        String minecraftCommand = String.join(" ", args);

                        if (minecraftCommand.length() > 0) {
                            ServerAPISender sender = new ServerAPISender();

                            Task.builder().execute(() -> Sponge.getCommandManager().process(sender, minecraftCommand))
                                    .name("AFMCP APISERVER command")
                                    .submit(Sponge.getPluginManager().getPlugin("afmcp").get().getInstance().get());

                            String commandOutput = String.join("\n", sender.getOutput());

                            if (commandOutput.length() > 0) {
                                ServerUtils.responseString(exchange, 200, commandOutput);
                            } else {
                                ServerUtils.responseString(exchange, 204, commandOutput);
                            }
                        } else {
                            ServerUtils.responseString(exchange, 400, "");
                        }
                        break;
                    case "PLAYER_LIST":
                        List<String> playerList = new ArrayList<>();

                        for (Player player : Sponge.getServer().getOnlinePlayers()) {
                            playerList.add(player.getName());
                        }

                        if (playerList.size() > 0) {
                            ServerUtils.responseString(exchange, 200, String.join("\n", playerList));
                        } else {
                            ServerUtils.responseString(exchange, 204, "");
                        }
                        break;
                    case "TAKE_SCREENSHOT":
                        ServerUtils.responseString(exchange, 200, defaultBase64);
                        break;
                    default:
                        ServerUtils.responseString(exchange, 405, "");
                        break;
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }

    class Auth extends Authenticator {
        @Override
        public Result authenticate(HttpExchange httpExchange) {
            if ("/forbidden".equals(httpExchange.getRequestURI().toString()))
                return new Failure(403);
            else
                return new Success(new HttpPrincipal("c0nst", "realm"));
        }
    }
}